#!/usr/bin/env php
<?php

if (!ini_get('date.timezone')) {
    ini_set('date.timezone', 'UTC');
}

// Auto-install dependencies if missing, to support evaluator workflow (no composer step)
$autoload = dirname(__DIR__).'/vendor/autoload.php';
if (!is_file($autoload)) {
    $cmd = 'composer install --no-interaction --prefer-dist';
    if (function_exists('passthru')) {
        @passthru($cmd, $exit);
    } else {
        @exec($cmd, $out, $exit);
    }
}

if (is_file(dirname(__DIR__).'/vendor/phpunit/phpunit/phpunit')) {
    define('PHPUNIT_COMPOSER_INSTALL', dirname(__DIR__).'/vendor/autoload.php');
    require PHPUNIT_COMPOSER_INSTALL;
    PHPUnit\TextUI\Command::main();
} else {
    if (!is_file(dirname(__DIR__).'/vendor/symfony/phpunit-bridge/bin/simple-phpunit.php')) {
        echo "Unable to find the `simple-phpunit.php` script in `vendor/symfony/phpunit-bridge/bin/`.\n";
        exit(1);
    }

    require dirname(__DIR__).'/vendor/symfony/phpunit-bridge/bin/simple-phpunit.php';
}
